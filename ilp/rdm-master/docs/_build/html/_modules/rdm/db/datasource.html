

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>rdm.db.datasource &mdash; Python-RDM 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> Python-RDM
          

          
          </a>

          
            
            
              <div class="version">
                0.1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html">Example use case</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../clowdflows.html">ClowdFlows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_reference.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../licences.html">Licences of included approaches</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Python-RDM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>rdm.db.datasource</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for rdm.db.datasource</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">pymysql</span> <span class="k">as</span> <span class="nn">mysql</span>


<span class="n">MYSQL_FIELD_TYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;DECIMAL&#39;</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;TINY&#39;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;SHORT&#39;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;LONG&#39;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;FLOAT&#39;</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;DOUBLE&#39;</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;NULL&#39;</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;TIMESTAMP&#39;</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39;LONGLONG&#39;</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="s1">&#39;INT24&#39;</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="s1">&#39;DATE&#39;</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">:</span> <span class="s1">&#39;TIME&#39;</span><span class="p">,</span>
    <span class="mi">12</span><span class="p">:</span> <span class="s1">&#39;DATETIME&#39;</span><span class="p">,</span>
    <span class="mi">13</span><span class="p">:</span> <span class="s1">&#39;YEAR&#39;</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">:</span> <span class="s1">&#39;NEWDATE&#39;</span><span class="p">,</span>
    <span class="mi">15</span><span class="p">:</span> <span class="s1">&#39;VARCHAR&#39;</span><span class="p">,</span>
    <span class="mi">16</span><span class="p">:</span> <span class="s1">&#39;BIT&#39;</span><span class="p">,</span>
    <span class="mi">246</span><span class="p">:</span> <span class="s1">&#39;NEWDECIMAL&#39;</span><span class="p">,</span>
    <span class="mi">247</span><span class="p">:</span> <span class="s1">&#39;INTERVAL&#39;</span><span class="p">,</span>
    <span class="mi">248</span><span class="p">:</span> <span class="s1">&#39;SET&#39;</span><span class="p">,</span>
    <span class="mi">249</span><span class="p">:</span> <span class="s1">&#39;TINY_BLOB&#39;</span><span class="p">,</span>
    <span class="mi">250</span><span class="p">:</span> <span class="s1">&#39;MEDIUM_BLOB&#39;</span><span class="p">,</span>
    <span class="mi">251</span><span class="p">:</span> <span class="s1">&#39;LONG_BLOB&#39;</span><span class="p">,</span>
    <span class="mi">252</span><span class="p">:</span> <span class="s1">&#39;BLOB&#39;</span><span class="p">,</span>
    <span class="mi">253</span><span class="p">:</span> <span class="s1">&#39;VAR_STRING&#39;</span><span class="p">,</span>
    <span class="mi">254</span><span class="p">:</span> <span class="s1">&#39;STRING&#39;</span><span class="p">,</span>
    <span class="mi">255</span><span class="p">:</span> <span class="s1">&#39;GEOMETRY&#39;</span>
<span class="p">}</span>


<div class="viewcode-block" id="DataSource"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.DataSource">[docs]</a><span class="k">class</span> <span class="nc">DataSource</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A data abstraction layer for accessing datasets.</span>

<span class="sd">    This layer is typically hidden from end-users, as they only access</span>
<span class="sd">    the database through DBConnection and DBContext objects.</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="DataSource.connect"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.DataSource.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            :return: a connection object.</span>
<span class="sd">            :rtype: DBConnection</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataSource.tables"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.DataSource.tables">[docs]</a>    <span class="k">def</span> <span class="nf">tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            :return: a list of table names.</span>
<span class="sd">            :rtype: list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataSource.table_columns"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.DataSource.table_columns">[docs]</a>    <span class="k">def</span> <span class="nf">table_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            :param table_name: table name for which to retrieve column names</span>
<span class="sd">            :return: a list of columns for the given table.</span>
<span class="sd">            :rtype: list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataSource.foreign_keys"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.DataSource.foreign_keys">[docs]</a>    <span class="k">def</span> <span class="nf">foreign_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            :return: a list of foreign key relations in the form (table_name, column_name, referenced_table_name, referenced_column_name).</span>
<span class="sd">            :rtype: list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataSource.table_column_names"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.DataSource.table_column_names">[docs]</a>    <span class="k">def</span> <span class="nf">table_column_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            :return: a list of table / column names in the form (table, col_name).</span>
<span class="sd">            :rtype: list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataSource.connected"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.DataSource.connected">[docs]</a>    <span class="k">def</span> <span class="nf">connected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">find_connections</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a list of tuples of connected table pairs.</span>

<span class="sd">            :param tables: a list of table names</span>
<span class="sd">            :param cols: a list of column names</span>
<span class="sd">            :param find_connections: set this to True to detect relationships from column names.</span>

<span class="sd">            :return: a tuple (connected, pkeys, fkeys, reverse_fkeys)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">connected</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">fkeys</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
        <span class="n">reverse_fkeys</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pkeys</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">fk_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">find_connections</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">[</span><span class="n">table</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_id&#39;</span><span class="p">):</span>
                            <span class="n">ref_table</span> <span class="o">=</span> <span class="p">(</span><span class="n">col</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;ies&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span> <span class="ow">and</span> <span class="n">col</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;e&#39;</span> <span class="k">else</span> <span class="p">(</span><span class="n">col</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">ref_table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
                                <span class="n">connected</span><span class="p">[(</span><span class="n">table</span><span class="p">,</span> <span class="n">ref_table</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">))</span>
                                <span class="n">connected</span><span class="p">[(</span><span class="n">ref_table</span><span class="p">,</span> <span class="n">table</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
                                <span class="n">fkeys</span><span class="p">[</span><span class="n">table</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                                <span class="n">reverse_fkeys</span><span class="p">[(</span><span class="n">table</span><span class="p">,</span> <span class="n">col</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ref_table</span>
                        <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span>
                            <span class="n">pkeys</span><span class="p">[</span><span class="n">table</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">ref_table</span><span class="p">,</span> <span class="n">ref_col</span><span class="p">)</span> <span class="ow">in</span> <span class="n">fk_result</span><span class="p">:</span>
                <span class="n">connected</span><span class="p">[(</span><span class="n">table</span><span class="p">,</span> <span class="n">ref_table</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">col</span><span class="p">,</span> <span class="n">ref_col</span><span class="p">))</span>
                <span class="n">connected</span><span class="p">[(</span><span class="n">ref_table</span><span class="p">,</span> <span class="n">table</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ref_col</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
                <span class="n">fkeys</span><span class="p">[</span><span class="n">table</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                <span class="n">reverse_fkeys</span><span class="p">[(</span><span class="n">table</span><span class="p">,</span> <span class="n">col</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ref_table</span>

            <span class="n">tbl_col_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_column_names</span><span class="p">()</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tbl_col_names</span><span class="p">:</span>
                <span class="n">pkeys</span><span class="p">[</span><span class="n">table</span><span class="p">]</span> <span class="o">=</span> <span class="n">pk</span>

        <span class="k">return</span> <span class="n">connected</span><span class="p">,</span> <span class="n">pkeys</span><span class="p">,</span> <span class="n">fkeys</span><span class="p">,</span> <span class="n">reverse_fkeys</span></div>

<div class="viewcode-block" id="DataSource.table_primary_key"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.DataSource.table_primary_key">[docs]</a>    <span class="k">def</span> <span class="nf">table_primary_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the primary key attribute name for the given table.</span>

<span class="sd">            :param table_name: table name string</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataSource.fetch"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.DataSource.fetch">[docs]</a>    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fetches rows for the given table and columns.</span>

<span class="sd">            :param table: target table</span>
<span class="sd">            :param cols: list of columns to select</span>
<span class="sd">            :return: rows from the given table and columns</span>
<span class="sd">            :rtype: list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataSource.select_where"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.DataSource.select_where">[docs]</a>    <span class="k">def</span> <span class="nf">select_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">pk_att</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Select with where clause.</span>

<span class="sd">            :param table: target table</span>
<span class="sd">            :param cols: list of columns to select</span>
<span class="sd">            :param pk_att: attribute for the where clause</span>
<span class="sd">            :param pk: the id that the pk_att should match</span>
<span class="sd">            :return: rows from the given table and cols, with the condition pk_att==pk</span>
<span class="sd">            :rtype: list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataSource.fetch_types"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.DataSource.fetch_types">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a dictionary of field types for the given table and columns.</span>

<span class="sd">            :param table: target table</span>
<span class="sd">            :param cols: list of columns to select</span>
<span class="sd">            :return: a dictionary of types for each attribute</span>
<span class="sd">            :rtype: dict</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="DataSource.column_values"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.DataSource.column_values">[docs]</a>    <span class="k">def</span> <span class="nf">column_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a list of distinct values for the given table and column.</span>

<span class="sd">            :param table: target table</span>
<span class="sd">            :param cols: list of columns to select</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">get_driver_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_jdbc_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>


<div class="viewcode-block" id="MySQLDataSource"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.MySQLDataSource">[docs]</a><span class="k">class</span> <span class="nc">MySQLDataSource</span><span class="p">(</span><span class="n">DataSource</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A DataSource implementation for accessing datasets from a MySQL DBMS.</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="MySQLDataSource.__init__"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.MySQLDataSource.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            :param connection: a DBConnection instance.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span></div>

<div class="viewcode-block" id="MySQLDataSource.connect"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.MySQLDataSource.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span></div>

<div class="viewcode-block" id="MySQLDataSource.foreign_keys"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.MySQLDataSource.foreign_keys">[docs]</a>    <span class="k">def</span> <span class="nf">foreign_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
               <span class="s2">&quot;SELECT table_name, column_name, referenced_table_name, referenced_column_name </span><span class="se">\</span>
<span class="s2">                FROM information_schema.KEY_COLUMN_USAGE </span><span class="se">\</span>
<span class="s2">                WHERE referenced_table_name IS NOT NULL AND table_schema=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
            <span class="n">fk_result</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fk_result</span></div>

<div class="viewcode-block" id="MySQLDataSource.table_column_names"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.MySQLDataSource.table_column_names">[docs]</a>    <span class="k">def</span> <span class="nf">table_column_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;SELECT table_name, column_name </span><span class="se">\</span>
<span class="s2">                 FROM information_schema.KEY_COLUMN_USAGE </span><span class="se">\</span>
<span class="s2">                 WHERE constraint_name=&#39;PRIMARY&#39; AND table_schema=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
            <span class="n">tbl_col_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tbl_col_names</span></div>

<div class="viewcode-block" id="MySQLDataSource.tables"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.MySQLDataSource.tables">[docs]</a>    <span class="k">def</span> <span class="nf">tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SHOW tables&#39;</span><span class="p">)</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span> <span class="k">for</span> <span class="p">(</span><span class="n">table</span><span class="p">,)</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tables</span></div>

<div class="viewcode-block" id="MySQLDataSource.table_columns"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.MySQLDataSource.table_columns">[docs]</a>    <span class="k">def</span> <span class="nf">table_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT column_name FROM information_schema.columns WHERE table_name = &#39;</span><span class="si">%s</span><span class="s2">&#39; AND table_schema=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">database</span><span class="p">))</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="p">(</span><span class="n">col</span><span class="p">,)</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">columns</span></div>

    <span class="k">def</span> <span class="nf">fmt_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;`</span><span class="si">%s</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">])</span>

<div class="viewcode-block" id="MySQLDataSource.fetch_types"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.MySQLDataSource.fetch_types">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="si">%s</span><span class="s2"> FROM `</span><span class="si">%s</span><span class="s2">` LIMIT 1&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt_cols</span><span class="p">(</span><span class="n">cols</span><span class="p">),</span> <span class="n">table</span><span class="p">))</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">types</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
                <span class="c1"># types[desc[0]] = mysql.FieldType.get_info(desc[1])</span>
                <span class="n">types</span><span class="p">[</span><span class="n">desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MYSQL_FIELD_TYPES</span><span class="p">[</span><span class="n">desc</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">types</span></div>

<div class="viewcode-block" id="MySQLDataSource.fetch"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.MySQLDataSource.fetch">[docs]</a>    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="si">%s</span><span class="s2"> FROM </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt_cols</span><span class="p">(</span><span class="n">cols</span><span class="p">),</span> <span class="n">table</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span> <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MySQLDataSource.select_where"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.MySQLDataSource.select_where">[docs]</a>    <span class="k">def</span> <span class="nf">select_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">pk_att</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt_cols</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="si">%s</span><span class="s2"> FROM </span><span class="si">%s</span><span class="s2"> WHERE `</span><span class="si">%s</span><span class="s2">`=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">pk_att</span><span class="p">,</span> <span class="n">pk</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span> <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MySQLDataSource.column_values"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.MySQLDataSource.column_values">[docs]</a>    <span class="k">def</span> <span class="nf">column_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT DISTINCT BINARY `</span><span class="si">%s</span><span class="s2">`, `</span><span class="si">%s</span><span class="s2">` FROM `</span><span class="si">%s</span><span class="s2">`&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">values</span></div>

    <span class="k">def</span> <span class="nf">get_driver_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;com.mysql.jdbc.Driver&#39;</span>

    <span class="k">def</span> <span class="nf">get_jdbc_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;jdbc:mysql://&#39;</span></div>


<div class="viewcode-block" id="PgSQLDataSource"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.PgSQLDataSource">[docs]</a><span class="k">class</span> <span class="nc">PgSQLDataSource</span><span class="p">(</span><span class="n">DataSource</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A DataSource implementation for accessing datasets from a PosgreSQL DBMS.</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="PgSQLDataSource.__init__"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.PgSQLDataSource.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            :param connection: a DBConnection instance.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span></div>

<div class="viewcode-block" id="PgSQLDataSource.connect"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.PgSQLDataSource.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span></div>

<div class="viewcode-block" id="PgSQLDataSource.foreign_keys"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.PgSQLDataSource.foreign_keys">[docs]</a>    <span class="k">def</span> <span class="nf">foreign_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">database</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="se">\</span>
<span class="s2">                    tc.table_name, kcu.column_name, </span><span class="se">\</span>
<span class="s2">                    ccu.table_name AS referenced_table_name,</span><span class="se">\</span>
<span class="s2">                    ccu.column_name AS referenced_column_name </span><span class="se">\</span>
<span class="s2">                    FROM </span><span class="se">\</span>
<span class="s2">                    information_schema.table_constraints AS tc </span><span class="se">\</span>
<span class="s2">                    JOIN information_schema.key_column_usage AS kcu </span><span class="se">\</span>
<span class="s2">                      ON tc.constraint_name = kcu.constraint_name </span><span class="se">\</span>
<span class="s2">                    JOIN information_schema.constraint_column_usage AS ccu </span><span class="se">\</span>
<span class="s2">                      ON ccu.constraint_name = tc.constraint_name </span><span class="se">\</span>
<span class="s2">                      WHERE constraint_type = &#39;FOREIGN KEY&#39; AND tc.table_catalog=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">database</span><span class="p">)</span>
            <span class="n">fk_result</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fk_result</span></div>

<div class="viewcode-block" id="PgSQLDataSource.table_column_names"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.PgSQLDataSource.table_column_names">[docs]</a>    <span class="k">def</span> <span class="nf">table_column_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">database</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;SELECT </span><span class="se">\</span>
<span class="s2">                tc.table_name, kcu.column_name </span><span class="se">\</span>
<span class="s2">                FROM </span><span class="se">\</span>
<span class="s2">                information_schema.table_constraints AS tc</span><span class="se">\</span>
<span class="s2">                JOIN information_schema.key_column_usage AS kcu </span><span class="se">\</span>
<span class="s2">                ON tc.constraint_name = kcu.constraint_name </span><span class="se">\</span>
<span class="s2">                WHERE constraint_type = &#39;PRIMARY KEY&#39; AND tc.table_catalog=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">database</span><span class="p">)</span>
            <span class="n">tbl_col_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tbl_col_names</span></div>

<div class="viewcode-block" id="PgSQLDataSource.tables"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.PgSQLDataSource.tables">[docs]</a>    <span class="k">def</span> <span class="nf">tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">database</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT table_name FROM information_schema.tables WHERE table_schema=</span><span class="se">\&#39;</span><span class="s2">public</span><span class="se">\&#39;</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                            AND table_type=</span><span class="se">\&#39;</span><span class="s2">BASE TABLE</span><span class="se">\&#39;</span><span class="s2"> AND table_catalog=&#39;</span><span class="si">%s</span><span class="s2">&#39; AND table_name NOT LIKE </span><span class="se">\&#39;\\</span><span class="s2">_</span><span class="si">%%</span><span class="se">\&#39;</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">database</span><span class="p">))</span> <span class="c1"># to escape this sql command: ... NOT LIKE &#39;\_%&#39;</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span> <span class="k">for</span> <span class="p">(</span><span class="n">table</span><span class="p">,)</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tables</span></div>

<div class="viewcode-block" id="PgSQLDataSource.table_columns"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.PgSQLDataSource.table_columns">[docs]</a>    <span class="k">def</span> <span class="nf">table_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">database</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT column_name FROM information_schema.columns </span><span class="se">\</span>
<span class="s2">            WHERE table_name = &#39;</span><span class="si">%s</span><span class="s2">&#39; AND table_catalog=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="n">database</span><span class="p">))</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="p">(</span><span class="n">col</span><span class="p">,)</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">columns</span></div>

    <span class="k">def</span> <span class="nf">fmt_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">])</span>

<div class="viewcode-block" id="PgSQLDataSource.fetch_types"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.PgSQLDataSource.fetch_types">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">types</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT attname as col_name, atttypid::regtype AS base_type </span><span class="se">\</span>
<span class="s2">                        FROM pg_catalog.pg_attribute WHERE attrelid = &#39;public.</span><span class="si">%s</span><span class="s2">&#39;::regclass </span><span class="se">\</span>
<span class="s2">                        AND attnum &gt; 0 AND NOT attisdropped ORDER  BY attnum;&quot;</span> <span class="o">%</span> <span class="n">table</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">types</span><span class="p">[</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">types</span></div>

<div class="viewcode-block" id="PgSQLDataSource.fetch"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.PgSQLDataSource.fetch">[docs]</a>    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="si">%s</span><span class="s2"> FROM </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt_cols</span><span class="p">(</span><span class="n">cols</span><span class="p">),</span> <span class="n">table</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span> <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="PgSQLDataSource.select_where"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.PgSQLDataSource.select_where">[docs]</a>    <span class="k">def</span> <span class="nf">select_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">pk_att</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt_cols</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT </span><span class="si">%s</span><span class="s2"> FROM </span><span class="si">%s</span><span class="s2"> WHERE </span><span class="si">%s</span><span class="s2">=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="n">val_att</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span> <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="PgSQLDataSource.column_values"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.PgSQLDataSource.column_values">[docs]</a>    <span class="k">def</span> <span class="nf">column_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT DISTINCT </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2"> FROM </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">values</span></div>

    <span class="k">def</span> <span class="nf">get_driver_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;org.postgresql.Driver&#39;</span>

    <span class="k">def</span> <span class="nf">get_jdbc_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;jdbc:postgresql://&#39;</span></div>


<div class="viewcode-block" id="SQLiteDataSource"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.SQLiteDataSource">[docs]</a><span class="k">class</span> <span class="nc">SQLiteDataSource</span><span class="p">(</span><span class="n">DataSource</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A DataSource implementation for accessing datasets from SQLite DBMS.</span>
<span class="sd">    Because SQLite types are dynamic and its CREATE TABLE statement allows for any kind of custom type names, we try to match the most common types with three type categories used in ``rdm``.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">continuous_types</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span> <span class="s1">&#39;double precision&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;decimal&#39;</span><span class="p">)</span>
    <span class="n">integer_types</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;tinyint&#39;</span><span class="p">,</span> <span class="s1">&#39;smallint&#39;</span><span class="p">,</span> <span class="s1">&#39;mediumint&#39;</span><span class="p">,</span> <span class="s1">&#39;bigint&#39;</span><span class="p">,</span> <span class="s1">&#39;unsigned big int&#39;</span><span class="p">,</span> <span class="s1">&#39;int2&#39;</span><span class="p">,</span> <span class="s1">&#39;int8&#39;</span><span class="p">)</span>
    <span class="n">ordinal_types</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;character&#39;</span><span class="p">,</span> <span class="s1">&#39;varchar&#39;</span><span class="p">,</span> <span class="s1">&#39;varying character&#39;</span><span class="p">,</span> <span class="s1">&#39;nchar&#39;</span><span class="p">,</span> <span class="s1">&#39;native character&#39;</span><span class="p">,</span> <span class="s1">&#39;nvarchar&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;clob&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="SQLiteDataSource.__init__"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.SQLiteDataSource.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            :param connection: a DBConnection instance.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">connection</span></div>

<div class="viewcode-block" id="SQLiteDataSource.connect"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.SQLiteDataSource.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span></div>

<div class="viewcode-block" id="SQLiteDataSource.foreign_keys"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.SQLiteDataSource.foreign_keys">[docs]</a>    <span class="k">def</span> <span class="nf">foreign_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;SELECT &quot;from&quot;,&quot;table&quot;,&quot;to&quot; FROM pragma_foreign_key_list(&quot;</span><span class="si">{}</span><span class="s1">&quot;);&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">table</span><span class="p">,)</span> <span class="o">+</span> <span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="SQLiteDataSource.table_column_names"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.SQLiteDataSource.table_column_names">[docs]</a>    <span class="k">def</span> <span class="nf">table_column_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT name FROM pragma_table_info(&quot;</span><span class="si">{}</span><span class="s1">&quot;) WHERE pk=1;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">table</span><span class="p">,</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="SQLiteDataSource.tables"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.SQLiteDataSource.tables">[docs]</a>    <span class="k">def</span> <span class="nf">tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT name FROM sqlite_master </span><span class="se">\</span>
<span class="s2">                            WHERE type=&#39;table&#39; AND name NOT LIKE &#39;sqlite_%&#39;;&quot;</span><span class="p">)</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">table</span> <span class="k">for</span> <span class="p">(</span><span class="n">table</span><span class="p">,)</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tables</span></div>

<div class="viewcode-block" id="SQLiteDataSource.table_columns"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.SQLiteDataSource.table_columns">[docs]</a>    <span class="k">def</span> <span class="nf">table_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT name FROM pragma_table_info(&quot;</span><span class="si">{}</span><span class="s1">&quot;);&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">))</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="p">(</span><span class="n">col</span><span class="p">,)</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">columns</span></div>

    <span class="k">def</span> <span class="nf">fmt_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">])</span>

<div class="viewcode-block" id="SQLiteDataSource.fetch_types"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.SQLiteDataSource.fetch_types">[docs]</a>    <span class="k">def</span> <span class="nf">fetch_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT &quot;name&quot;, &quot;type&quot; from pragma_table_info(&quot;</span><span class="si">{}</span><span class="s1">&quot;) WHERE &quot;name&quot; IN (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt_cols</span><span class="p">(</span><span class="n">cols</span><span class="p">)))</span>
            <span class="n">types</span> <span class="o">=</span> <span class="p">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\([0-9a-zA-Z ,]*\)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">types</span></div>

<div class="viewcode-block" id="SQLiteDataSource.fetch"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.SQLiteDataSource.fetch">[docs]</a>    <span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT </span><span class="si">%s</span><span class="s1"> FROM &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt_cols</span><span class="p">(</span><span class="n">cols</span><span class="p">),</span> <span class="n">table</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span> <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="SQLiteDataSource.select_where"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.SQLiteDataSource.select_where">[docs]</a>    <span class="k">def</span> <span class="nf">select_where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">pk_att</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmt_cols</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT </span><span class="si">%s</span><span class="s1"> FROM &quot;</span><span class="si">%s</span><span class="s1">&quot; WHERE &quot;</span><span class="si">%s</span><span class="s1">&quot;=&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">pk_att</span><span class="p">,</span> <span class="n">pk</span><span class="p">))</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">cols</span> <span class="k">for</span> <span class="n">cols</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="SQLiteDataSource.column_values"><a class="viewcode-back" href="../../../api_reference.html#rdm.db.datasource.SQLiteDataSource.column_values">[docs]</a>    <span class="k">def</span> <span class="nf">column_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT DISTINCT &quot;</span><span class="si">%s</span><span class="s1">&quot; FROM &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">table</span><span class="p">))</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">values</span></div>

    <span class="k">def</span> <span class="nf">get_driver_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;java.sql.DriverManager&#39;</span>

    <span class="k">def</span> <span class="nf">get_jdbc_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;jdbc:sqlite:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">sqlite_database</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016, Anze Vavpetic, Matic Perovsek

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>